@using FalmatazClothing.Models.DTO.CartItem;
@model CreateCartItemDto


@{
    ViewData["Title"] = "Create Cart Item";
}

<div class="row">
    <div class="col-md-8 mx-auto rounded border p-3">
        <h2 class="text-center">Add Item to Cart</h2>
        <form asp-controller="CartItem" asp-action="CreateCartItem" method="post">
            <div class="mb-3">
                <label for="ProductStyle">Select a Product Style</label>
                <select id="ProductStyle" name="ProductStyle" class="form-control" onchange="updateProductDetails()">
                    <option value="">-- Select Product --</option>
                    @foreach (var item in (List<SelectListItem>)ViewData["selectProducts"])
                    {
                        <option value="@item.Value" data-price="@item.Group.Name">@item.Text</option>
                    }
                </select>

                <label class="form-label">Product Image</label>
                <img id="productImage" src="~/Images/" alt="Product Image" style="width: 100px; height: auto" />

                <label class="form-label">Quantity</label>
                <input type="number" class="form-control" id="Quantity" name="Quantity" value="1" required oninput="calculateTotal()">

                <label class="form-label">Price</label>
                <input type="number" class="form-control" id="Price" name="Price" required readonly>

                <label class="form-label">Total Price</label>
                <input type="text" class="form-control" id="TotalPrice" name="TotalPrice" required readonly>

                <button type="submit" class="btn btn-primary mt-3">Add to Cart</button>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    <script>
        // Convert C# ViewData to JavaScript object
        var productData = @Html.Raw(Json.Serialize(ViewData["productData"]));

        function updateProductDetails() {
            var selectedProductId = document.getElementById("ProductStyle").value;
            var product = productData.find(p => p.id === selectedProductId);

            if (product) {
                document.getElementById("productImage").src = "/Images/" + product.ImageProduct;

                document.getElementById("Price").value = product.price;
                document.getElementById("Quantity").value = 1; // Default quantity
                calculateTotal(); // Call function to update total price
            }
        }

        function calculateTotal() {
            var price = parseFloat(document.getElementById("Price").value);
            var quantity = parseInt(document.getElementById("Quantity").value);
            if (!isNaN(price) && !isNaN(quantity)) {
                document.getElementById("TotalPrice").value = (price * quantity).toFixed(2);
            }
        }
    </script>

}

